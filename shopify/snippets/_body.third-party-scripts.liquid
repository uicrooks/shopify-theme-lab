{%- if template != "cart" -%}
<script type="text/javascript" defer>
  window.addEventListener('load', function() {
      // inject + load all 3rd parties
      /* WISTIA */
      {% unless template == 'account' %}
      jQuery172('body').append('<script src="//fast.wistia.com/assets/external/E-v1.js" defer><\/script>')
      {% endunless %}
      /* END WISTIA */

      /* GTM */
        jQuery172('body').append(`<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MQXWN9');<\/script>
<!-- End Google Tag Manager -->`)
      /* END GTM */

      /* YAHOO */
      jQuery172('body').append(`<!-- Yahoo Gemini -->
        <script type="application/javascript">
        (function(w,d,t,r,u){w[u]=w[u]||[];w[u].push({'projectId':'10000','properties':{'pixelId':'10063850'}});
        var s=d.createElement(t);s.src=r;s.async=true;s.onload=s.onreadystatechange=function(){var y,rs=this.readyState,c=w[u];if(rs&&rs!="complete"&&rs!="loaded")
        {return}try{y=YAHOO.ywa.I13N.fireBeacon;w[u]=[];w[u].push=function(p){y([p])};y(c)}catch(e){}};var scr=d.getElementsByTagName(t)[0],
        par=scr.parentNode;par.insertBefore(s,scr)})(window,document,"script","https://s.yimg.com/wi/ytc.js","dotq");
      <\/script>
        <!-- END Yahoo Gemini -->`);
      /* END YAHOO */

      /* CRITEO */
          jQuery172('body').append('<!-- CRITEO --><script type="text/javascript" src="//static.criteo.net/js/ld/ld.js" async="true"><\/script>');
          jQuery172('body').append(`<script type="text/javascript">
          window.criteo_q = window.criteo_q || [];
          var deviceType = /iPad/.test(navigator.userAgent) ? "t" : /Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Silk/.test(navigator.userAgent) ? "m" : "d";
          var site_type = /Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Silk/.test(navigator.userAgent) ? "m" : /iPad/.test(navigator.userAgent) ? "t" : "d";
          window.criteo_q = window.criteo_q || [];
          window.criteo_q.push(
          { event: "setAccount", account: 22076},
          { event: "setSiteType", type: site_type},
          {% if customer %}
          { event: "setEmail", email: ["{{ customer.email }}"]},
          {% endif %}
          { event: "manualFlush"});
          <\/script><!-- END CRITEO -->`)
          {% if template.name == 'index' %}
            jQuery172('body').append('<script>window.criteo_q.push({event: "viewHome" },{event: "flushEvents"});<\/script>');
          {% endif %}
          {%- if template == "product" -%}
            jQuery172('body').append(`<script type="text/javascript">
                window.criteo_q = window.criteo_q || [];
                var deviceType = /iPad/.test(navigator.userAgent) ? "t" : /Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Silk/.test(navigator.userAgent) ? "m" : "d";
                window.criteo_q.push(
                { event: "setAccount", account: 22076}, // You should never update this line
                {% if customer %}
                { event: "setEmail", email: "{{ customer.email }}"},
                {% endif %}
                { event: "setSiteType", type: deviceType},
                { event: "viewItem", item: "{{ product.id }}" });
                console.log('Criteo View Item Sent');
            <\/script>`)
          {%- endif -%}
          {%- if template.name == "collection" and collection.handle != 'best-sellers' -%}
          {%- assign product_id = "" -%}
          {%- for product in collection.products limit: 3 -%}
          {%- assign product_id =  product_id | append: product.id | append: ',' -%}
          {%- endfor -%}
          {%- assign pro_id = product_id | split: ',' | join : ', ' -%}
            jQuery172('body').append(`<script type="text/javascript">
              window.criteo_q = window.criteo_q || [];
              var deviceType = /iPad/.test(navigator.userAgent) ? "t" : /Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Silk/.test(navigator.userAgent) ? "m" : "d";
              window.criteo_q.push(
              { event: "setAccount", account: 22076}, // You should never update this line  
              {% if customer %}
              { event: "setEmail", email: "{{ customer.email }}"},
              {% endif %}
              { event: "setSiteType", type: deviceType},
              { event: "viewList", item: [{{pro_id}}] });
              console.log('Criteo ViewList Sent');
            <\/script>`)
          {%- endif -%}
      /* END CRITEO */

      /* KLAVIYO */
        jQuery172('body').append(`<!-- KLAVIYO INIT --><script>
          var _learnq = _learnq || [];
          _learnq.push(['account', 'pWh7nE']);
          (function () {
            var b = document.createElement('script'); b.type = 'text/javascript'; b.async = true;
            b.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'a.klaviyo.com/media/js/analytics/analytics.js';
            var a = document.getElementsByTagName('script')[0]; a.parentNode.insertBefore(b, a);
          })();
		  var timeout_count = 0;
          function wait4klv() {
            if (_learnq.hasOwnProperty('identify')) {
                app._3p_identify()
            } else if (timeout_count<4) {
				timeout_count++;
                setTimeout(function() {wait4klv()},3000);
            }
          }
          wait4klv();
        <\/script><!-- END KLAVIYO -->`);
        {% if template == 'page.bundles-page' %}
        jQuery172('body').append(`<script>
          var _learnq = _learnq || [];
          {% if customer %}
          _learnq.push(['identify', {'$email' : '{{customer.email}}'}]);
          {% endif %}
          _learnq.push(['track', 'Viewed Bundles']);
        <\/script><!-- END KLAVIYO -->`);
        {% endif %}
        {%- if template == "product" -%}
          jQuery172('body').append(`<!-- Klaviyo View Product --><script text="text/javascript">console.log('Fired Klv View Product');
              var _learnq = _learnq || [];
              var item = {
                Name: {{ product.title|json }},
                ProductID: {{ product.id|json }},
                Categories: {{ product.collections|map:'title'|json }},
                ImageURL: "https:{{ product.featured_image.src|img_url:'grande' }}",
                URL: "{{ shop.secure_url }}{{ product.url }}",
                Brand: {{ product.vendor|json }},
                Currency: '{{cart.currency}}',
                Price: {{ product.price|money|json }},
                CompareAtPrice: {{ product.compare_at_price_max|money|json }}
              };

              _learnq.push(['track', 'Viewed Product', item]);
              _learnq.push(['trackViewedItem', {
                Title: item.Name,
                ItemId: item.ProductID,
                Categories: item.Categories,
                ImageUrl: item.ImageURL,
                Url: item.URL,
                Metadata: {
                  Brand: item.Brand,
                  Price: item.Price,
                  CompareAtPrice: item.CompareAtPrice
                }
              }]);
          <\/script><!-- End Klaviyo View Product -->`);
          {% if customer %}
          jQuery172('body').append(`<!-- KLAVIYO Browse Product --><script type="text/javascript">
            var customer_email = "{{ customer.email }}";
            var customerFirstName = "{{ customer.first_name }}";
            var customerLastName = "{{ customer.last_name }}";
            var purchasedTime = new Date().getTime();
            _learnq.push(['track', 'Browse Product', {
              "event" : "Browse Product",
              "customer_properties": {
                  "$email" : customer_email,
                  "$first_name" : customerFirstName,
                  "$last_name" : customerLastName
              },
              "productName": "{{ product.title }}",
              "productId": "{{ product.id }}",
              "productPrice": "{{ product.price | money }}",
              "ProductURL" : "https://drsquatch.com/shop/product/{{ product.id }}",
              "time": purchasedTime
            }]);
          <\/script><!-- END Klaviyo Browse Product-->`)
          {% endif %}
        {% endif %}
      /* END KLAVIYO */

      /* Pintrest */
      jQuery172('body').append(`<script type="text/javascript">
      !function(e){if(!window.pintrk){window.pintrk=function(){window.pintrk.queue.push(
        Array.prototype.slice.call(arguments))};var
        n=window.pintrk;n.queue=[],n.version="3.0";var
        t=document.createElement("script");t.async=!0,t.src=e;var
        r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}}("https://s.pinimg.com/ct/core.js");
      pintrk('load', '2617908370808', {em: '{{ customer.email }}'});
      pintrk('page');
        <\/script>`);
      jQuery172('body').append(`<noscript>
        <img height="1" width="1" style="display:none;" alt=""
          src="https://ct.pinterest.com/v3/?tid=2617908370808&noscript=1" />
      <\/noscript>`)
      /* END pintrest */

      /* Military Seller */
      {% if template.name != 'index' %}
      jQuery172('<script id="idsm_js" src="https://cdn.id.discount/seller/launcher.js" data-key="3a07c0ea9"><\/script>')
      {% endif %}
      /* END Military Seller */

      /* Survicate */
      {% if template.directory == 'customers' %}
        {% assign user_id = customer.id %}
        jQuery172('body').append(`<script type="text/javascript">
            (function (w) {
              var s = document.createElement('script');
              s.src = '//survey.survicate.com/workspaces/bd0cca1ea338864015e788844bc476de/web_surveys.js';
              s.async = true;
              var e = document.getElementsByTagName('script')[0];
              e.parentNode.insertBefore(s, e);
            })(window);
        <\/script>`);
        jQuery172('body').append(`<script type="text/javascript">
            (function(opts) {
              opts.traits = {
                "user_id": "{{user_id}}"
              };
            })(window._sva = window._sva || {});
        <\/script>`);
    {% endif %}

      /* END Survicate */
    jQuery172('body').append(`<script src="https://cdn-widgetsrepository.yotpo.com/v1/loader/aVmUCojw7M4SVKvRhQWlyw"><\/script>`);
    jQuery172('<img src="//i.geistm.com/x/DrS">').appendTo('body');
    console.log('third party scripts loaded');
  })
</script>
{%- endif -%}


{% comment %} All Cart Page Specific Scripts because there is no Jquery on that page {% endcomment %}
{%- if template == "cart" -%}
{%- assign a = '' -%}
{%- for item in cart.items -%}
{%- capture cart_item -%}{ id: "{{ item.id }}", price: "{{ item.price | money }}", quantity: {{ item.quantity }}
}{%- endcapture -%}
{%- assign a = a | append:cart_item | append: ',' -%}
{%- endfor -%}
{%- assign cart_json = a | split:',' | join: ', ' -%}
  <script type="text/javascript">
    window.criteo_q = window.criteo_q || [];
    var deviceType = /iPad/.test(navigator.userAgent) ? "t" : /Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Silk/.test(navigator.userAgent) ? "m" : "d";
    window.criteo_q.push(
    { event: "setAccount", account: 22076}, // You should never update this line
    { event: "setEmail", email: "{{ shop.email | md5 }}" }, // Can be an empty string 
    { event: "setSiteType", type: deviceType},
    { event: "viewBasket", item: [{{ cart_json }}]}
    );
  </script>
  <script type="application/javascript">
    (function(w,d,t,r,u){w[u]=w[u]||[];w[u].push({'projectId':'10000','properties':{'pixelId':'10063850'}});
    var s=d.createElement(t);s.src=r;s.async=true;s.onload=s.onreadystatechange=function(){var y,rs=this.readyState,c=w[u];if(rs&&rs!="complete"&&rs!="loaded")
    {return}try{y=YAHOO.ywa.I13N.fireBeacon;w[u]=[];w[u].push=function(p){y([p])};y(c)}catch(e){}};var scr=d.getElementsByTagName(t)[0],
    par=scr.parentNode;par.insertBefore(s,scr)})(window,document,"script","https://s.yimg.com/wi/ytc.js","dotq");
  </script>
  <script>
      var _learnq = _learnq || [];
      _learnq.push(['account', 'pWh7nE']);
      (function () {
        var b = document.createElement('script'); b.type = 'text/javascript'; b.async = true;
        b.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'a.klaviyo.com/media/js/analytics/analytics.js';
        var a = document.getElementsByTagName('script')[0]; a.parentNode.insertBefore(b, a);
      })();
    </script>
{% endif %}